<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Student Login - myTUT Events</title>
  <link href="{{ url_for('static', filename='images/favicon.ico') }}" rel="shortcut icon"
    type="image/vnd.microsoft.icon" />

  <!-- Fonts and Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
    rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet" />

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            "tut-blue": "#0A2463",
            "tut-red": "#990000",
            "tut-yellow": "#E6A817",
            "dark-bg": "#121212",
            "dark-card": "#1E1E1E",
          },
          fontFamily: {
            sans: ["Poppins", "sans-serif"],
          },
          animation: {
            'float': 'float 6s ease-in-out infinite',
            'glow': 'glow 2s ease-in-out infinite alternate',
            'bounce-slow': 'bounce 3s infinite',
            'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
          }
        },
      },
    };
  </script>

  <!-- Alpine.js -->
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

  <style>
    @keyframes float {

      0%,
      100% {
        transform: translateY(0px);
      }

      50% {
        transform: translateY(-15px);
      }
    }

    @keyframes glow {
      from {
        box-shadow: 0 0 15px rgba(230, 168, 23, 0.4);
      }

      to {
        box-shadow: 0 0 25px rgba(230, 168, 23, 0.7);

      }
    }

    .glassmorphism {
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(15px);
      border: 1px solid rgba(255, 255, 255, 0.25);
    }

    .gradient-text {
      background: linear-gradient(135deg, #E6A817, #990000);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .particles {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 1;
    }

    .particle {
      position: absolute;
      width: 3px;
      height: 3px;
      background: rgba(230, 168, 23, 0.5);
      border-radius: 50%;
      animation: float 7s infinite linear;
    }

    body {
      background-image: linear-gradient(rgba(10, 36, 99, 0.8), rgba(10, 36, 99, 0.8)),
      url("{{ url_for('static', filename='images/tut-1.webp') }}");
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
    }
  </style>
</head>

<body class="font-sans min-h-screen relative overflow-x-hidden" x-data="loginApp()">
  <!-- Header -->
  <header class="relative z-50 glassmorphism">
    <div class="container mx-auto px-4">
      <div class="flex items-center justify-between py-4">
        <!-- Logo -->
        <a href="{{ url_for('index') }}" class="flex items-center">
          <img src="{{ url_for('static', filename='images/favicon.ico') }}" alt="myTUT Events Logo"
            class="h-12 w-12 mr-3" />
          <span class="text-white text-2xl font-bold">MyTUT<span class="text-tut-yellow">Events</span></span>
        </a>

        <!-- Desktop Navigation -->
        <nav class="hidden md:block">
          <ul class="flex items-center space-x-8">
            <li><a href="{{ url_for('index') }}"
                class="text-white hover:text-tut-yellow font-medium transition-colors duration-200">Home</a></li>
            <li><a href="{{ url_for('about') }}"
                class="text-white hover:text-tut-yellow font-medium transition-colors duration-200">About</a></li>
            <li><a href="{{ url_for('upcoming_events') }}"
                class="text-white hover:text-tut-yellow font-medium transition-colors duration-200">Events</a></li>
            <li><a href="{{ url_for('gallery') }}"
                class="text-white hover:text-tut-yellow font-medium transition-colors duration-200">Gallery</a></li>
            <li>
              <a href="{{ url_for('login_studemail') }}"
                class="bg-tut-yellow text-gray-900 font-semibold px-6 py-2.5 rounded-full shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200 flex items-center gap-2">
                <i class="fas fa-user-plus"></i>Email Login
              </a>
            </li>
          </ul>
        </nav>
      </div>
    </div>
  </header>
  <!-- Main Content -->
  <main class="relative z-10 min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-lg">
      <!-- Login Card -->
      <div
        class="glassmorphism rounded-2xl shadow-xl p-8 transform hover:scale-[1.01] transition-all duration-300 animate-glow">
        <!-- Header -->
        <div class="text-center mb-6">
          <div class="relative">
            <div
              class="bg-tut-yellow rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4 shadow-lg animate-float">
              <i class="fas fa-graduation-cap text-tut-blue text-2xl"></i>
            </div>
          </div>
          <h1 class="text-2xl font-bold gradient-text mb-2">Welcome Back!</h1>
          <p class="text-white/70 text-sm" x-text="getGreeting()"></p>
        </div>

        <!-- Tab System -->
        <div class="flex glassmorphism rounded-xl p-1 mb-6">
          <button
            class="flex-1 py-2 px-4 bg-tut-blue text-white rounded-lg font-semibold transition-all duration-200 hover:bg-blue-700">
            USING ITS
            PIN</button>
          <a href="{{ url_for('login_studemail') }}"
            class="flex-1 py-2 px-4 text-white/80 hover:text-white hover:bg-white/20 rounded-lg text-center transition-all duration-200">Student
            Email Login
          </a>
        </div>

        <!-- Login Form -->
        <form @submit.prevent="handleLogin" class="space-y-5">
          <!-- Student Number Field -->
          <div class="relative">
            <label class="block text-sm font-medium text-white/90 mb-1 flex items-center gap-2">
              <i class="fas fa-id-card text-tut-yellow"></i> Student Number
            </label>
            <div class="relative">
              <input type="text" minlength="9" maxlength="9" inputmode="numeric" pattern="[0-9]{9}"
                x-model="form.studentNumber" @input="validateStudentNumber()"
                class="w-full px-4 py-3 glassmorphism text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-tut-yellow/50 transition-all placeholder-white/60"
                :class="{
                  'ring-2 ring-green-400': isValidStudentNumber(), 
                  'ring-2 ring-tut-red': form.studentNumber && !isValidStudentNumber()
                }" placeholder="Enter your 9-digit student number" autocomplete="username" required>
              <div class="absolute inset-y-0 right-0 pr-3 flex items-center">
                <i x-show="isValidStudentNumber()" class="fas fa-check text-green-400"></i>
                <i x-show="form.studentNumber && !isValidStudentNumber()"
                  class="fas fa-exclamation-triangle text-tut-red"></i>
              </div>
            </div>
            <div x-show="studentNumberSuggestion" class="mt-1 text-xs text-tut-yellow" x-text="studentNumberSuggestion">
            </div>
            <div x-show="errors.studentNumber" class="text-tut-red text-xs mt-1" x-text="errors.studentNumber"></div>
          </div>

          <!-- Password Field -->
          <div class="relative">
            <label class="block text-sm font-medium text-white/90 mb-1 flex items-center gap-2">
              <i class="fas fa-lock text-tut-yellow"></i>PIN
            </label>
            <div class="relative">
              <input :type="showPassword ? 'text' : 'password'" x-model="form.password"
                class="w-full px-4 py-3 glassmorphism text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-tut-yellow/50 transition-all placeholder-white/60"
                placeholder="Enter your PIN" autocomplete="current-password" required>
              <button type="button" @click="showPassword = !showPassword"
                class="absolute inset-y-0 right-0 pr-3 flex items-center text-white/70 hover:text-tut-yellow">
                <i :class="showPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
              </button>
            </div>
            <div x-show="errors.password" class="text-tut-red text-xs mt-1" x-text="errors.password"></div>
          </div>

          <!-- Features Row -->
          <div class="flex items-center justify-between text-sm">
            <label class="flex items-center text-white/80 cursor-pointer hover:text-tut-yellow">
              <input type="checkbox" x-model="form.rememberMe"
                class="rounded border-white/30 text-tut-yellow focus:ring-tut-yellow/50 mr-2">
              Keep me signed in
            </label>
            <a href="#" @click="showForgotPasswordModal = true"
              class="text-tut-yellow hover:text-yellow-400 hover:underline">
              Forgot password?
            </a>
          </div>

          <!-- Login Button -->
          <button type="submit" :disabled="isLoading || !canSubmit()"
            class="w-full bg-tut-blue hover:bg-blue-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white py-3 rounded-lg font-semibold transition-all duration-200 flex items-center justify-center"
            :class="{'animate-pulse': isLoading}">
            <span x-show="!isLoading">
              <i class="fas fa-sign-in-alt mr-2"></i> Sign In
            </span>
            <span x-show="isLoading" class="flex items-center">
              <i class="fas fa-spinner animate-spin mr-2"></i>
              <span x-text="loginProgress"></span>
            </span>
          </button>
        </form>

        <!-- Register Link -->
        <div class="mt-6 text-center text-white/80">
          <p>Don't have an account?
            <a href="/register" class="text-tut-yellow hover:underline font-semibold">Register here</a>
          </p>
        </div>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="relative z-10 bg-tut-blue/90 text-white py-8">
    <div class="container mx-auto px-4">
      <div class="grid md:grid-cols-3 gap-6">
        <div>
          <div class="flex items-center mb-3">
            <div class="h-8 w-8 mr-2 bg-tut-yellow rounded flex items-center justify-center">
              <i class="fas fa-graduation-cap text-tut-blue"></i>
            </div>
            <span class="text-lg font-bold">MyTUT<span class="text-tut-yellow">Events</span></span>
          </div>
          <p class="text-gray-300 text-sm">Join the TUT community and never miss an event!</p>
        </div>
        <div>
          <h3 class="font-semibold mb-3 text-tut-yellow">Quick Links</h3>
          <ul class="space-y-2 text-sm text-gray-300">
            <li><a href="/about" class="hover:text-tut-yellow">About Us</a></li>
            <li><a href="/events" class="hover:text-tut-yellow">Events</a></li>
            <li><a href="/contact" class="hover:text-tut-yellow">Contact</a></li>
          </ul>
        </div>
        <div>
          <h3 class="font-semibold mb-3 text-tut-yellow">Connect</h3>
          <div class="flex space-x-4">
            <a href="#" class="text-gray-300 hover:text-tut-yellow"><i class="fab fa-facebook-f text-lg"></i></a>
            <a href="#" class="text-gray-300 hover:text-tut-yellow"><i class="fab fa-twitter text-lg"></i></a>
            <a href="#" class="text-gray-300 hover:text-tut-yellow"><i class="fab fa-instagram text-lg"></i></a>
          </div>
        </div>
      </div>
      <div class="border-t border-gray-600 mt-6 pt-6 text-center">
        <p class="text-gray-400 text-sm">&copy; 2024 MyTUT Events. All rights reserved.</p>
      </div>
    </div>
  </footer>

  <script>
    function loginApp() {
      return {
        form: {
          studentNumber: '',
          password: '',
          rememberMe: false,
        },
        errors: {},
        isLoading: false,
        loginProgress: 'Signing in...',
        showPassword: false,
        showForgotPasswordModal: false,
        studentNumberSuggestion: '',

        init() {
          console.log('Login app initialized');
        },

        getGreeting() {
          const hour = new Date().getHours();
          if (hour < 12) return 'Good morning! Ready to explore events?';
          if (hour < 18) return 'Good afternoon! Let\'s see what\'s happening today.';
          return 'Good evening! Time to catch up on events.';
        },

        validateStudentNumber() {
          // Remove any non-numeric characters
          this.form.studentNumber = this.form.studentNumber.replace(/[^0-9]/g, '');

          // Limit to 9 characters
          if (this.form.studentNumber.length > 9) {
            this.form.studentNumber = this.form.studentNumber.slice(0, 9);
          }

          // Clear previous error
          if (this.errors.studentNumber) {
            delete this.errors.studentNumber;
          }
        },

        isValidStudentNumber() {
          return /^[0-9]{9}$/.test(this.form.studentNumber);
        },

        canSubmit() {
          return this.isValidStudentNumber() && this.form.password.length >= 4;
        },

        showToast(message, type) {
          // Simple alert for now - you can replace with a proper toast system
          const icon = type === 'success' ? '✅' : '❌';
          alert(`${icon} ${message}`);
        },

        async handleLogin() {
          console.log('Login form submitted');

          // Reset errors
          this.errors = {};
          this.isLoading = true;

          // Validate student number
          if (!this.isValidStudentNumber()) {
            this.errors.studentNumber = 'Please enter a valid 9-digit student number';
            this.isLoading = false;
            return;
          }

          // Validate password
          if (this.form.password.length < 4) {
            this.errors.password = 'PIN must be at least 4 characters';
            this.isLoading = false;
            return;
          }

          // Simulate login process
          const steps = [
            'Verifying credentials...',
            'Checking student status...',
            'Loading your profile...',
            'Almost ready...'
          ];

          try {
            for (let i = 0; i < steps.length; i++) {
              this.loginProgress = steps[i];
              await new Promise(resolve => setTimeout(resolve, 800));
            }

            // Send form data to Flask backend
            const formData = new FormData();
            formData.append('studentNumber', this.form.studentNumber);
            formData.append('password', this.form.password);
            formData.append('rememberMe', this.form.rememberMe);

            const response = await fetch('/login', {
              method: 'POST',
              body: formData
            });

            const data = await response.json();

            if (data.success) {
              this.showToast(data.message, 'success');

              // Redirect on success
              setTimeout(() => {
                window.location.href = data.redirect;
              }, 1500);
            } else {
              this.showToast(data.message, 'error');
            }
          } catch (error) {
            console.error('Login error:', error);
            this.showToast('Network error. Please try again.', 'error');
          } finally {
            this.isLoading = false;
          }
        }
      }
    }
  </script>
</body>

</html>